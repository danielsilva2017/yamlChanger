{
    "name": "cassandra",
    "image": "cassandra",
    "ports": [
        {
            "name": "intra-node",
            "containerPort": 7000,
            "protocol": "TCP"
        },
        {
            "name": "tls-intra-node",
            "containerPort": 7001,
            "protocol": "TCP"
        },
        {
            "name": "jmx",
            "containerPort": 7199,
            "protocol": "TCP"
        },
        {
            "name": "cql",
            "containerPort": 9042,
            "protocol": "TCP"
        }
    ],
    "env": [
        {
            "name": "MAX_HEAP_SIZE",
            "value": "4G"
        },
        {
            "name": "HEAP_NEWSIZE",
            "value": "1G"
        },
        {
            "name": "CASSANDRA_SEEDS",
            "value": "cassandra-0.cassandra.default.svc.cluster.local"
        },
        {
            "name": "CASSANDRA_CLUSTER_NAME",
            "value": "K8Demo"
        },
        {
            "name": "CASSANDRA_DC",
            "value": "DC1-K8Demo"
        },
        {
            "name": "CASSANDRA_RACK",
            "value": "Rack1-K8Demo"
        },
        {
            "name": "CASSANDRA_SEED_PROVIDER",
            "value": "io.k8s.cassandra.KubernetesSeedProvider"
        },
        {
            "name": "POD_IP",
            "valueFrom": {
                "fieldRef": {
                    "apiVersion": "v1",
                    "fieldPath": "status.podIP"
                }
            }
        }
    ],
    "resources": {
        "limits": {
            "cpu": "3",
            "memory": "8Gi"
        },
        "requests": {
            "cpu": "501m",
            "memory": "2Gi"
        }
    },
    "readinessProbe": {
        "exec": {
            "command": [
                "/bin/bash",
                "-c",
                "cat < /dev/null > /dev/tcp/${POD_IP}/9042"
            ]
        },
        "initialDelaySeconds": 15,
        "timeoutSeconds": 5,
        "periodSeconds": 10,
        "successThreshold": 1,
        "failureThreshold": 3
    },
    "lifecycle": {
        "preStop": {
            "exec": {
                "command": [
                    "/bin/sh",
                    "-c",
                    "nodetool drain"
                ]
            }
        }
    },
    "terminationMessagePath": "/dev/termination-log",
    "terminationMessagePolicy": "File",
    "imagePullPolicy": "Always",
    "securityContext": {
        "capabilities": {
            "add": [
                "IPC_LOCK"
            ]
        }
    }
}